INSERT INTO pipelines (name, is_active, description, pipeline_type_id, brand_id, run_frequency, last_actor)
    VALUES
        ('sun_ilumya_extract', TRUE, 'Pipeline till initial ingest for Sun.', (SELECT id FROM pipeline_types WHERE name = 'patient_journey'), (SELECT id from brands WHERE name = 'ILUMYA'), 'weekly', 'njb@integrichain.com'),
        ('sun_odomzo_extract', TRUE, 'Pipeline till initial ingest for Sun.', (SELECT id FROM pipeline_types WHERE name = 'patient_journey'), (SELECT id from brands WHERE name = 'ODOMZO'), 'weekly', 'njb@integrichain.com');

INSERT INTO transformation_templates (name, variable_structures, pipeline_state_type_id, last_actor) 
    VALUES
        ('initial_ingest', 
        '{"delimiter":{"datatype": "string", "description": "the input file delimiter"},"skip_rows":{"datatype":"int","description":"the number of rows to skip at the top of the file"},"encoding":{"datatype":"string","description":"the encoding of the input file"},"input_file_prefix":{"datatype":"string","description":"the prefix of the selected input files"}}', 
        (SELECT id FROM pipeline_state_types WHERE name = 'ingest'),
        'njb@integrichain.com'),

        ('extract_from_ftp', 
        '{"remote_path":{"datatype": "string", "description": "The path to follow on the remote server"},"prefix":{"datatype":"string","description":"The prefix of files to get on the remote server"},"secret_name":{"datatype":"string","description":"The name of the secret in Secret Manager for the remote server"},"secret_type_of":{"datatype":"string","description":"The type of the secret in Secret Manager for the remote server"}}', 
        (SELECT id FROM pipeline_state_types WHERE name = 'raw'),
        'njb@integrichain.com'),

        ('symphony_health_association_ingest_column_mapping', 
        '{"ingest_source_transform":{"datatype": "string", "description": ""},"ingest_source_file_prefix":{"datatype": "string", "description": ""},"rec_date_col":{"datatype": "string", "description": ""},"pharm_code_col":{"datatype": "string", "description": ""},"pharm_npi":{"datatype": "string", "description": ""},"transtype":{"datatype": "string", "description": ""},"pharm_transaction_id":{"datatype": "string", "description": ""},"trans_seq":{"datatype": "string", "description": ""},"ref_source":{"datatype": "string", "description": ""},"ref_date":{"datatype": "string", "description": ""},"program_id":{"datatype": "string", "description": ""},"pharmacy_id":{"datatype": "string", "description": ""},"pat_last_name":{"datatype": "string", "description": ""},"pat_first_name":{"datatype": "string", "description": ""},"pat_dob":{"datatype": "string", "description": ""},"pat_gender":{"datatype": "string", "description": ""},"pat_addr1":{"datatype": "string", "description": ""},"pat_addr2":{"datatype": "string", "description": ""},"pat_city":{"datatype": "string", "description": ""},"pat_state":{"datatype": "string", "description": ""},"pat_zip":{"datatype": "string", "description": ""},"dx1_code":{"datatype": "string", "description": ""},"dx2_code":{"datatype": "string", "description": ""},"status_date":{"datatype": "string", "description": ""},"status_code":{"datatype": "string", "description": ""},"sub_status":{"datatype": "string", "description": ""},"pres_last_name":{"datatype": "string", "description": ""},"pres_first_name":{"datatype": "string", "description": ""},"pres_addr1":{"datatype": "string", "description": ""},"pres_addr2":{"datatype": "string", "description": ""},"pres_city":{"datatype": "string", "description": ""},"pres_state":{"datatype": "string", "description": ""},"pres_zip":{"datatype": "string", "description": ""},"pres_phone":{"datatype": "string", "description": ""},"pres_npi":{"datatype": "string", "description": ""},"pres_dea":{"datatype": "string", "description": ""},"facility_name":{"datatype": "string", "description": ""},"rxdate":{"datatype": "string", "description": ""},"rxnumber":{"datatype": "string", "description": ""},"rxrefills":{"datatype": "string", "description": ""},"rxfill":{"datatype": "string", "description": ""},"refill_remaining":{"datatype": "string", "description": ""},"prev_disp":{"datatype": "string", "description": ""},"rx_ndc_number":{"datatype": "string", "description": ""},"medication":{"datatype": "string", "description": ""},"quantity":{"datatype": "string", "description": ""},"day_supply":{"datatype": "string", "description": ""},"ship_date":{"datatype": "string", "description": ""},"ship_carrier":{"datatype": "string", "description": ""},"shiptracking_num":{"datatype": "string", "description": ""},"ship_location":{"datatype": "string", "description": ""},"ship_address":{"datatype": "string", "description": ""},"ship_city":{"datatype": "string", "description": ""},"ship_state":{"datatype": "string", "description": ""},"ship_zip":{"datatype": "string", "description": ""},"has_medical":{"datatype": "string", "description": ""},"primary_coverage_type":{"datatype": "string", "description": ""},"primary_payer_name":{"datatype": "string", "description": ""},"primary_payer_type":{"datatype": "string", "description": ""},"secondary_coverage_type":{"datatype": "string", "description": ""},"secondary_payer_name":{"datatype": "string", "description": ""},"secondary_payer_type":{"datatype": "string", "description": ""},"plan_paid_amt":{"datatype": "string", "description": ""},"pat_copay":{"datatype": "string", "description": ""},"copay_assist_amount":{"datatype": "string", "description": ""},"oth_payer_amt":{"datatype": "string", "description": ""},"xfer_pharmname":{"datatype": "string", "description": ""},"msa_patient_id":{"datatype": "string", "description": ""},"msa_patient_bmap":{"datatype": "string", "description": ""},"metadata_run_timestamp":{"datatype": "string", "description": ""},"metadata_app_version":{"datatype": "string", "description": ""},"metadata_output_contract":{"datatype": "string", "description": ""}}', 
        (SELECT id FROM pipeline_state_types WHERE name = 'ingest'),
        'njb@integrichain.com'),

        ('symphony_health_association_map_product_ndcs', 
        '{"input_transform":{"datatype": "string", "description": "The name of the transform to input source data from"},"index_col":{"datatype":"string","description":"The index column to map NDCs in the source dataset (default is rx_ndc_number)"},"secret_name":{"datatype":"string","description":"The name of the secret in Secret Manager for the remote server"},"secret_type_of":{"datatype":"string","description":"The type of the secret in Secret Manager for the remote server"}}', 
        (SELECT id FROM pipeline_state_types WHERE name = 'master'),
        'njb@integrichain.com'),

        ('symphony_health_association_filter_to_brand', 
        '{"input_transform":{"datatype": "string", "description": "The name of the transform to input source data from"}}', 
        (SELECT id FROM pipeline_state_types WHERE name = 'master'),
        'njb@integrichain.com'),

        ('symphony_health_association_infer_med_details', 
        '{"input_transform":{"datatype": "string", "description": "The name of the transform to input source data from"}}', 
        (SELECT id FROM pipeline_state_types WHERE name = 'master'),
        'njb@integrichain.com'),

        ('symphony_health_association_remap_pharm_codes', 
        '{"input_transform":{"datatype": "string", "description": "The name of the transform to input source data from"}}', 
        (SELECT id FROM pipeline_state_types WHERE name = 'enrich'),
        'njb@integrichain.com'),

        ('symphony_health_association_filter_shipment_only', 
        '{"input_transform":{"datatype": "string", "description": "The name of the transform to input source data from"}}', 
        (SELECT id FROM pipeline_state_types WHERE name = 'enrich'),
        'njb@integrichain.com'),

        ('symphony_health_association_extract_column_mapping', 
        '{"input_transform":{"datatype": "string", "description": "The name of the transform to input source data from"}}', 
        (SELECT id FROM pipeline_state_types WHERE name = 'dimensional'),
        'njb@integrichain.com'),

        ('publish_to_ftp', 
        '{"input_transform":{"datatype": "string", "description": "name of transformation to pull dataset from"},"prefix":{"datatype": "string", "description": "file prefix to publish to ftp"},"suffix":{"datatype": "string", "description": "file suffix to publish to ftp"},"filetype":{"datatype": "string", "description": "filetype to publish to ftp (DO NOT INCLUDE . IN FILETYPE)"},"separator":{"datatype": "string", "description": "single character separator for output file"},"compression":{"datatype": "bool", "description": "if true published file will be compressed as gzip"},"date_format":{"datatype": "string", "description": "string formatting for datetime"},"remote_path":{"datatype": "string", "description": "path to publish to on FTP server"},"secret_name":{"datatype": "string", "description": "AWS secret name containing FTP credentials"},"secret_type_of":{"datatype": "string", "description": "AWS secret type of. should almost always be FTP"}}', 
        (SELECT id FROM pipeline_state_types WHERE name = 'dimensional'),
        'njb@integrichain.com');

INSERT INTO pipeline_states (pipeline_state_type_id, pipeline_id, graph_order, last_actor)
    VALUES 
        ((SELECT id FROM pipeline_state_types WHERE name = 'raw'), (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract'), 0, 'njb@integrichain.com'),
        ((SELECT id FROM pipeline_state_types WHERE name = 'ingest'), (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract'), 1, 'njb@integrichain.com'),
        ((SELECT id FROM pipeline_state_types WHERE name = 'master'), (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract'), 2, 'njb@integrichain.com'),
        ((SELECT id FROM pipeline_state_types WHERE name = 'enrich'), (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract'), 3, 'njb@integrichain.com'),
        ((SELECT id FROM pipeline_state_types WHERE name = 'dimensional'), (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract'), 4, 'njb@integrichain.com'),

        ((SELECT id FROM pipeline_state_types WHERE name = 'raw'), (SELECT id FROM pipelines WHERE name = 'sun_odomzo_extract'), 0, 'njb@integrichain.com'),
        ((SELECT id FROM pipeline_state_types WHERE name = 'ingest'), (SELECT id FROM pipelines WHERE name = 'sun_odomzo_extract'), 1, 'njb@integrichain.com'),
        ((SELECT id FROM pipeline_state_types WHERE name = 'master'), (SELECT id FROM pipelines WHERE name = 'sun_odomzo_extract'), 2, 'njb@integrichain.com'),
        ((SELECT id FROM pipeline_state_types WHERE name = 'enrich'), (SELECT id FROM pipelines WHERE name = 'sun_odomzo_extract'), 3, 'njb@integrichain.com'),
        ((SELECT id FROM pipeline_state_types WHERE name = 'dimensional'), (SELECT id FROM pipelines WHERE name = 'sun_odomzo_extract'), 4, 'njb@integrichain.com');

INSERT INTO transformations (transformation_template_id, pipeline_state_id, graph_order, last_actor)
    VALUES
        ((SELECT id FROM transformation_templates WHERE name = 'extract_from_ftp'),(SELECT id FROM pipeline_states WHERE pipeline_state_type_id = (SELECT id FROM pipeline_state_types WHERE name = 'raw') AND pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')), 0, 'njb@integrichain.com'),
        ((SELECT id FROM transformation_templates WHERE name = 'initial_ingest'),(SELECT id FROM pipeline_states WHERE pipeline_state_type_id = (SELECT id FROM pipeline_state_types WHERE name = 'ingest') AND pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')), 0, 'njb@integrichain.com'),
        ((SELECT id FROM transformation_templates WHERE name = 'symphony_health_association_ingest_column_mapping'),(SELECT id FROM pipeline_states WHERE pipeline_state_type_id = (SELECT id FROM pipeline_state_types WHERE name = 'ingest') AND pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')), 1, 'njb@integrichain.com'),
        ((SELECT id FROM transformation_templates WHERE name = 'symphony_health_association_map_product_ndcs'),(SELECT id FROM pipeline_states WHERE pipeline_state_type_id = (SELECT id FROM pipeline_state_types WHERE name = 'master') AND pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')), 0, 'njb@integrichain.com'),
        ((SELECT id FROM transformation_templates WHERE name = 'symphony_health_association_filter_to_brand'),(SELECT id FROM pipeline_states WHERE pipeline_state_type_id = (SELECT id FROM pipeline_state_types WHERE name = 'master') AND pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')), 1, 'njb@integrichain.com'),
        ((SELECT id FROM transformation_templates WHERE name = 'symphony_health_association_infer_med_details'),(SELECT id FROM pipeline_states WHERE pipeline_state_type_id = (SELECT id FROM pipeline_state_types WHERE name = 'master') AND pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')), 2, 'njb@integrichain.com'),
        ((SELECT id FROM transformation_templates WHERE name = 'symphony_health_association_remap_pharm_codes'),(SELECT id FROM pipeline_states WHERE pipeline_state_type_id = (SELECT id FROM pipeline_state_types WHERE name = 'enrich') AND pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')), 0, 'njb@integrichain.com'),
        ((SELECT id FROM transformation_templates WHERE name = 'symphony_health_association_filter_shipment_only'),(SELECT id FROM pipeline_states WHERE pipeline_state_type_id = (SELECT id FROM pipeline_state_types WHERE name = 'enrich') AND pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')), 1, 'njb@integrichain.com'),
        ((SELECT id FROM transformation_templates WHERE name = 'symphony_health_association_extract_column_mapping'),(SELECT id FROM pipeline_states WHERE pipeline_state_type_id = (SELECT id FROM pipeline_state_types WHERE name = 'dimensional') AND pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')), 0, 'njb@integrichain.com'),
        ((SELECT id FROM transformation_templates WHERE name = 'symphony_health_association_extract_to_ftp'),(SELECT id FROM pipeline_states WHERE pipeline_state_type_id = (SELECT id FROM pipeline_state_types WHERE name = 'dimensional') AND pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')), 1, 'njb@integrichain.com'),

        ((SELECT id FROM transformation_templates WHERE name = 'extract_from_ftp'),(SELECT id FROM pipeline_states WHERE pipeline_state_type_id = (SELECT id FROM pipeline_state_types WHERE name = 'raw') AND pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_odomzo_extract')), 0, 'njb@integrichain.com'),
        ((SELECT id FROM transformation_templates WHERE name = 'initial_ingest'),(SELECT id FROM pipeline_states WHERE pipeline_state_type_id = (SELECT id FROM pipeline_state_types WHERE name = 'ingest') AND pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_odomzo_extract')), 0, 'njb@integrichain.com'),
        ((SELECT id FROM transformation_templates WHERE name = 'symphony_health_association_ingest_column_mapping'),(SELECT id FROM pipeline_states WHERE pipeline_state_type_id = (SELECT id FROM pipeline_state_types WHERE name = 'ingest') AND pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_odomzo_extract')), 1, 'njb@integrichain.com'),
        ((SELECT id FROM transformation_templates WHERE name = 'symphony_health_association_map_product_ndcs'),(SELECT id FROM pipeline_states WHERE pipeline_state_type_id = (SELECT id FROM pipeline_state_types WHERE name = 'master') AND pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_odomzo_extract')), 0, 'njb@integrichain.com'),
        ((SELECT id FROM transformation_templates WHERE name = 'symphony_health_association_filter_to_brand'),(SELECT id FROM pipeline_states WHERE pipeline_state_type_id = (SELECT id FROM pipeline_state_types WHERE name = 'master') AND pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_odomzo_extract')), 1, 'njb@integrichain.com'),
        ((SELECT id FROM transformation_templates WHERE name = 'symphony_health_association_infer_med_details'),(SELECT id FROM pipeline_states WHERE pipeline_state_type_id = (SELECT id FROM pipeline_state_types WHERE name = 'master') AND pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_odomzo_extract')), 2, 'njb@integrichain.com'),
        ((SELECT id FROM transformation_templates WHERE name = 'symphony_health_association_remap_pharm_codes'),(SELECT id FROM pipeline_states WHERE pipeline_state_type_id = (SELECT id FROM pipeline_state_types WHERE name = 'enrich') AND pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_odomzo_extract')), 0, 'njb@integrichain.com'),
        ((SELECT id FROM transformation_templates WHERE name = 'symphony_health_association_filter_shipment_only'),(SELECT id FROM pipeline_states WHERE pipeline_state_type_id = (SELECT id FROM pipeline_state_types WHERE name = 'enrich') AND pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_odomzo_extract')), 1, 'njb@integrichain.com'),
        ((SELECT id FROM transformation_templates WHERE name = 'symphony_health_association_extract_column_mapping'),(SELECT id FROM pipeline_states WHERE pipeline_state_type_id = (SELECT id FROM pipeline_state_types WHERE name = 'dimensional') AND pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_odomzo_extract')), 0, 'njb@integrichain.com'),
        ((SELECT id FROM transformation_templates WHERE name = 'symphony_health_association_extract_to_ftp'),(SELECT id FROM pipeline_states WHERE pipeline_state_type_id = (SELECT id FROM pipeline_state_types WHERE name = 'dimensional') AND pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_odomzo_extract')), 1, 'njb@integrichain.com');

INSERT INTO transformation_variables (name, transformation_id, value, last_actor)
    VALUES
        ('ingest_source_transform',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'ingest_source_transform' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'initial_ingest', 'njb@integrichain.com'),
        ('ingest_source_file_prefix',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'ingest_source_file_prefix' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'INTEGRICHAIN_SUN_WALGREENS_STATUSDISPENSE', 'njb@integrichain.com'),
        ('rec_date_col',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'rec_date_col' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'rec_date', 'njb@integrichain.com'),
        ('pharm_code_col',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'pharm_code_col' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'pharm_code', 'njb@integrichain.com'),
        ('pharm_npi',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'pharm_npi' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'pharm_npi', 'njb@integrichain.com'),
        ('transtype',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'transtype' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'transtype', 'njb@integrichain.com'),
        ('pharm_transaction_id',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'pharm_transaction_id' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'pharm_transaction_id', 'njb@integrichain.com'),
        ('trans_seq',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'trans_seq' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'trans_seq', 'njb@integrichain.com'),
        ('ref_source',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'ref_source' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'ref_source', 'njb@integrichain.com'),
        ('ref_date',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'ref_date' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'ref_date', 'njb@integrichain.com'),
        ('program_id',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'program_id' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'program_id', 'njb@integrichain.com'),
        ('pharmacy_id',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'pharmacy_id' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'pharmacy_id', 'njb@integrichain.com'),
        ('pat_last_name',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'pat_last_name' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'pat_last_name', 'njb@integrichain.com'),
        ('pat_first_name',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'pat_first_name' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'pat_first_name', 'njb@integrichain.com'),
        ('pat_dob',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'pat_dob' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'pat_dob', 'njb@integrichain.com'),
        ('pat_gender',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'pat_gender' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'pat_gender', 'njb@integrichain.com'),
        ('pat_addr1',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'pat_addr1' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'pat_addr1', 'njb@integrichain.com'),
        ('pat_addr2',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'pat_addr2' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'pat_addr2', 'njb@integrichain.com'),
        ('pat_city',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'pat_city' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'pat_city', 'njb@integrichain.com'),
        ('pat_state',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'pat_state' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'pat_state', 'njb@integrichain.com'),
        ('pat_zip',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'pat_zip' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'pat_zip', 'njb@integrichain.com'),
        ('dx1_code',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'dx1_code' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'dx1_code', 'njb@integrichain.com'),
        ('dx2_code',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'dx2_code' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'dx2_code', 'njb@integrichain.com'),
        ('status_date',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'status_date' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'status_date', 'njb@integrichain.com'),
        ('status_code',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'status_code' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'status_code', 'njb@integrichain.com'),
        ('sub_status',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'sub_status' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'sub_status', 'njb@integrichain.com'),
        ('pres_last_name',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'pres_last_name' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'pres_last_name', 'njb@integrichain.com'),
        ('pres_first_name',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'pres_first_name' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'pres_first_name', 'njb@integrichain.com'),
        ('pres_addr1',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'pres_addr1' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'pres_addr1', 'njb@integrichain.com'),
        ('pres_addr2',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'pres_addr2' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'pres_addr2', 'njb@integrichain.com'),
        ('pres_city',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'pres_city' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'pres_city', 'njb@integrichain.com'),
        ('pres_state',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'pres_state' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'pres_state', 'njb@integrichain.com'),
        ('pres_zip',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'pres_zip' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'pres_zip', 'njb@integrichain.com'),
        ('pres_phone',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'pres_phone' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'pres_phone', 'njb@integrichain.com'),
        ('pres_npi',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'pres_npi' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'pres_npi', 'njb@integrichain.com'),
        ('pres_dea',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'pres_dea' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'pres_dea', 'njb@integrichain.com'),
        ('facility_name',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'facility_name' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'facility_name', 'njb@integrichain.com'),
        ('rxdate',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'rxdate' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'rxdate', 'njb@integrichain.com'),
        ('rxnumber',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'rxnumber' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'rxnumber', 'njb@integrichain.com'),
        ('rxrefills',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'rxrefills' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'rxrefills', 'njb@integrichain.com'),
        ('rxfill',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'rxfill' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'rxfill', 'njb@integrichain.com'),
        ('refill_remaining',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'refill_remaining' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'refill_remaining', 'njb@integrichain.com'),
        ('prev_disp',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'prev_disp' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'prev_disp', 'njb@integrichain.com'),
        ('rx_ndc_number',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'rx_ndc_number' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'rx_ndc_number', 'njb@integrichain.com'),
        ('medication',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'medication' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'medication', 'njb@integrichain.com'),
        ('quantity',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'quantity' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'quantity', 'njb@integrichain.com'),
        ('day_supply',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'day_supply' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'day_supply', 'njb@integrichain.com'),
        ('ship_date',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'ship_date' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'ship_date', 'njb@integrichain.com'),
        ('ship_carrier',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'ship_carrier' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'ship_carrier', 'njb@integrichain.com'),
        ('shiptracking_num',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'shiptracking_num' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'shiptracking_num', 'njb@integrichain.com'),
        ('ship_location',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'ship_location' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'ship_location', 'njb@integrichain.com'),
        ('ship_address',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'ship_address' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'ship_address', 'njb@integrichain.com'),
        ('ship_city',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'ship_city' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'ship_city', 'njb@integrichain.com'),
        ('ship_state',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'ship_state' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'ship_state', 'njb@integrichain.com'),
        ('ship_zip',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'ship_zip' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'ship_zip', 'njb@integrichain.com'),
        ('has_medical',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'has_medical' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'has_medical', 'njb@integrichain.com'),
        ('primary_coverage_type',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'primary_coverage_type' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'primary_coverage_type', 'njb@integrichain.com'),
        ('primary_payer_name',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'primary_payer_name' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'primary_payer_name', 'njb@integrichain.com'),
        ('primary_payer_type',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'primary_payer_type' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'primary_payer_type', 'njb@integrichain.com'),
        ('secondary_coverage_type',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'secondary_coverage_type' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'secondary_coverage_type', 'njb@integrichain.com'),
        ('secondary_payer_name',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'secondary_payer_name' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'secondary_payer_name', 'njb@integrichain.com'),
        ('secondary_payer_type',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'secondary_payer_type' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'secondary_payer_type', 'njb@integrichain.com'),
        ('plan_paid_amt',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'plan_paid_amt' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'plan_paid_amt', 'njb@integrichain.com'),
        ('pat_copay',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'pat_copay' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'pat_copay', 'njb@integrichain.com'),
        ('copay_assist_amount',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'copay_assist_amount' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'copay_assist_amount', 'njb@integrichain.com'),
        ('oth_payer_amt',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'oth_payer_amt' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'oth_payer_amt', 'njb@integrichain.com'),
        ('xfer_pharmname',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'xfer_pharmname' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'xfer_pharmname', 'njb@integrichain.com'),
        ('msa_patient_id',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'msa_patient_id' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'msa_patient_id', 'njb@integrichain.com'),
        ('msa_patient_bmap',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'msa_patient_bmap' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), 'msa_patient_bmap', 'njb@integrichain.com'),
        ('metadata_run_timestamp',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'metadata_run_timestamp' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), '__metadata_run_timestamp', 'njb@integrichain.com'),
        ('metadata_app_version',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'metadata_app_version' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), '__metadata_app_version', 'njb@integrichain.com'),
        ('metadata_output_contract',(SELECT id FROM transformations WHERE (pipeline_state_id IN (SELECT id FROM pipeline_states WHERE pipeline_id = (SELECT id FROM pipelines WHERE name = 'sun_ilumya_extract')) AND id = (SELECT id FROM transformations WHERE (id NOT IN (SELECT t.id FROM transformations t INNER JOIN transformation_variables tv ON t.id = tv.transformation_id WHERE tv.name = 'metadata_output_contract' ORDER BY t.id)) AND id IN (SELECT t.id from transformations t INNER JOIN transformation_templates tt ON t.transformation_template_id = tt.id WHERE tt.name = 'symphony_health_association_ingest_column_mapping')ORDER BY id LIMIT 1))), '__metadata_output_contract', 'njb@integrichain.com');
#!/bin/sh

. script/script_setup
echo $DIR
TYPE=$1
docker-compose stop;
docker-compose rm -f configurationpg;
if [ "$1" == "--build" ]; then
    docker-compose build;
    TYPE=$2
fi
xterm -e echo hello world --hold
AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID \
AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY \
docker-compose up -d;
if [ "$TYPE" == "--gui" ]; then
    open -a Terminal ./script/gui_api
fi

docker-compose exec notebook /bin/bash -c "cd core/core/database && alembic upgrade head"


## adding the ssh daemon here so we don't run it in prod by accident
docker-compose exec notebook /bin/bash -c "apt-get update && \
apt-get install -y openssh-server && \
mkdir /var/run/sshd && \
useradd -ms /bin/bash corebot_remote && \
 echo -e 'corebot_remote\ncorebot_remote' | passwd corebot_remote && \
service ssh start" 
script/dev_shell $TYPE

##useradd -p $(openssl passwd -1 corebot_remote) -ms /bin/bash corebot_remote
